name: Build PRoot Multi-Arch (Static)

on:
  workflow_dispatch:

jobs:
  build-arm64:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true

      - name: Install Cross-Compiler & Libs
        run: |
          sudo apt-get update
          # Install compiler buat ARM64 dan library statisnya
          sudo apt-get install -y \
            gcc-aarch64-linux-gnu \
            binutils-aarch64-linux-gnu \
            libtalloc-dev:arm64 \
            libarchive-dev:arm64 \
            libseccomp-dev:arm64 \
            uthash-dev

      - name: Build Static PRoot (ARM64)
        run: |
          # Kita arahkan CC ke cross-compiler
          make -C src proot \
            CC=aarch64-linux-gnu-gcc \
            LDFLAGS="-static" \
            V=1

      - name: Upload ARM64 Binary
        uses: actions/upload-artifact@v4
        with:
          name: proot-static-arm64
          path: src/proot

  build-x86_64:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true

      - name: Install Libs
        run: |
          sudo apt-get update
          sudo apt-get install -y libtalloc-dev libarchive-dev libseccomp-dev uthash-dev

      - name: Build Static PRoot (x86_64)
        run: |
          make -C src proot LDFLAGS="-static"

      - name: Upload x86_64 Binary
        uses: actions/upload-artifact@v4
        with:
          name: proot-static-x86_64
          path: src/proot
